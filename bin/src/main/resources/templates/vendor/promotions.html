<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{vendor/layout}">
<head>
<title>Quản lý khuyến mãi</title>
<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/vendor/header.css">
	<link rel="stylesheet" href="/styles/css/vendor/main.css">
</th:block>
</head>
<body>
	<div layout:fragment="content">

		<!-- ================= THỐNG KÊ ================= -->
		<div class="stats-cards">
			<div class="stat-card total">
				<h3>Tổng số khuyến mãi</h3>
				<div class="value" id="totalPromotionsStat"
					th:text="${totalPromotions} ?: '0'">0</div>
			</div>
			<div class="stat-card inactive">
				<h3>Chưa kích hoạt</h3>
				<div class="value" id="inactivePromotionsStat"
					th:text="${inactivePromotions} ?: '0'">0</div>
			</div>
			<div class="stat-card active">
				<h3>Đang hoạt động</h3>
				<div class="value" id="activePromotionsStat"
					th:text="${activePromotions} ?: '0'">0</div>
			</div>
			<div class="stat-card expiring">
				<h3>Sắp hết hạn</h3>
				<div class="value" id="expiringPromotionsStat"
					th:text="${expiringPromotions} ?: '0'">0</div>
			</div>
			<div class="stat-card expired">
				<h3>Đã hết hạn</h3>
				<div class="value" id="expiredPromotionsStat"
					th:text="${expiredPromotions} ?: '0'">0</div>
			</div>
		</div>

		<!-- ================= TÌM KIẾM & LỌC ================= -->
		<div class="search-filter-container">
			<form id="searchFilterForm" th:action="@{/vendor/promotions}"
				method="get">
				<div class="search-box">
					<input type="text" name="keyword"
						placeholder="Tìm kiếm theo tên..." th:value="${keyword}">
					<button type="submit">
						<i class="fas fa-search"></i> Tìm kiếm
					</button>
				</div>
				<div class="filter-group">
					<div class="filter-item">
						<label for="statusFilter">Trạng thái:</label> <select
							id="statusFilter" name="status">
							<option value="" th:selected="${selectedStatus == null}">Tất
								cả</option>
							<option th:each="status : ${statuses}"
								th:value="${status.name()}" th:text="${status.displayName}"
								th:selected="${selectedStatus == status.name()}"></option>
						</select>
					</div>


					<div class="filter-item">
						<label for="typeFilter">Loại khuyến mãi:</label> <select
							id="typeFilter" name="type">
							<option value="" th:selected="${selectedType == null}">Tất
								cả</option>
							<option th:each="type : ${promotionTypes}"
								th:value="${type.name()}" th:text="${type.displayName}"
								th:selected="${selectedType == type.name()}"></option>
						</select>
					</div>

				</div>
			</form>
		</div>

		<!-- ================= NÚT HÀNH ĐỘNG ================= -->
		<div class="btn-add-container">
			<a href="javascript:void(0)" class="btn-add"
				onclick="openModal('addPromotionModal')"> <i class="fas fa-plus"></i>
				Thêm khuyến mãi
			</a>
		</div>

		<!-- ================= BẢNG KHUYẾN MÃI ================= -->
		<div class="table-promotions">
			<table>
				<thead>
					<tr>
						<th>ID</th>
						<th>Tên khuyến mãi</th>
						<th>Loại</th>
						<th>Giá trị</th>
						<th>Thời gian bắt đầu</th>
						<th>Thời gian kết thúc</th>
						<th>Trạng thái</th>
						<th>Thao tác</th>
					</tr>
				</thead>
				<tbody id="promotionTableBody">
					<tr>
						<td colspan="8" style="text-align: center;">Đang tải dữ
							liệu...</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- ================= PHÂN TRANG ================= -->
		<div class="pagination" id="promotionPagination"></div>

		<!-- ================= MODAL THÊM ================= -->
		<div id="addPromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Thêm Khuyến Mãi</h2>
					<button type="button" class="close-modal"
						onclick="closeModal('addPromotionModal')">&times;</button>
				</div>
				<div class="modal-body">
					<form id="promotionForm" novalidate>
						<div class="form-group">
							<label for="tenkm">Tên khuyến mãi:</label> <input type="text"
								id="tenkm" name="tenkm" required>
							<div class="error-message" id="tenkm-error"></div>
						</div>

						<div class="form-group">
							<label for="loaiKm">Loại khuyến mãi:</label> <select id="loaiKm"
								name="loaiKm" required>
								<option value="">Chọn loại khuyến mãi</option>
								<option th:each="type : ${promotionTypes}"
									th:value="${type.name()}" th:text="${type.displayName}"></option>
							</select>
							<div class="error-message" id="loaiKm-error"></div>
						</div>

						<div class="form-group">
							<label for="giaTri">Giá trị:</label> <input type="number"
								id="giaTri" name="giaTri" min="0" step="0.01" required>
							<div class="error-message" id="giaTri-error"></div>
						</div>

						<div class="form-group">
							<label for="moTa">Mô tả:</label>
							<textarea id="moTa" name="moTa" rows="3"
								placeholder="Mô tả chi tiết..."></textarea>
							<div class="error-message" id="moTa-error"></div>
						</div>

						<div class="form-group">
							<label for="thoiGianBd">Thời gian bắt đầu:</label> <input
								type="datetime-local" id="thoiGianBd" name="thoiGianBd" required>
							<div class="error-message" id="thoiGianBd-error"></div>
						</div>

						<div class="form-group">
							<label for="thoiGianKt">Thời gian kết thúc:</label> <input
								type="datetime-local" id="thoiGianKt" name="thoiGianKt" required>
							<div class="error-message" id="thoiGianKt-error"></div>
						</div>

						<div class="form-group">
							<label for="customerRank">Hạng khách hàng:</label> <select
								id="customerRank" name="customerRank">
								<option value="">Chọn hạng khách hàng</option>
								<option th:each="rank : ${customerRanks}"
									th:value="${rank.name()}" th:text="${rank.displayName}"></option>
							</select>
							<div class="error-message" id="customerRank-error"></div>
						</div>

						<!-- Danh sách sản phẩm áp dụng -->
						<div class="form-group">
							<label>Sản phẩm áp dụng:</label>
							<table id="relatedProductsTable">
								<thead>
									<tr>
										<th>Sản phẩm</th>
										<th>Thao tác</th>
									</tr>
								</thead>
								<tbody>
									<tr class="product-row default-row">
										<td><select name="products[0].productId">
												<option value="">Chọn sản phẩm</option>
												<option th:each="prod : ${products}" th:value="${prod.maSP}"
													th:text="${prod.tenSP}"></option>
										</select></td>
										<td><button type="button" class="btn-remove" disabled>Xóa</button></td>
									</tr>
								</tbody>
							</table>
							<button type="button" class="btn-add-row"
								onclick="addRelatedProductRow()">
								<i class="fas fa-plus"></i> Thêm sản phẩm
							</button>
						</div>
						<div class="form-actions">
							<div class="modal-footer">

								<button type="submit" class="btn-submit">Thêm khuyến
									mãi</button>
								<button type="button" class="btn-cancel"
									onclick="closeModal('addPromotionModal')">Hủy</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- ================= MODAL XEM CHI TIẾT ================= -->
		<div id="viewPromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Chi tiết Khuyến Mãi</h2>
					<button type="button" class="close-modal"
						onclick="closeModal('viewPromotionModal')">&times;</button>
				</div>
				<div class="modal-body">
					<table class="table-detail">
						<tr>
							<th>Tên khuyến mãi</th>
							<td id="viewTenkm"></td>
						</tr>
						<tr>
							<th>Loại khuyến mãi</th>
							<td id="viewLoaiKm"></td>
						</tr>
						<tr>
							<th>Giá trị</th>
							<td id="viewGiaTri"></td>
						</tr>
						<tr>
							<th>Mô tả</th>
							<td id="viewMoTa" style="white-space: pre-wrap;"></td>
						</tr>
						<tr>
							<th>Thời gian bắt đầu</th>
							<td id="viewThoiGianBd"></td>
						</tr>
						<tr>
							<th>Thời gian kết thúc</th>
							<td id="viewThoiGianKt"></td>
						</tr>
						<tr>
							<th>Loại khách hàng</th>
							<td id="viewCustomerRank"></td>
						</tr>
					</table>

					<br>
					<h4>Sản phẩm áp dụng</h4>
					<br>

					<table class="table-detail" id="viewProductsTable">
						<thead>
							<tr>
								<th>STT</th>
								<th>Mã sản phẩm</th>
								<th>Tên sản phẩm</th>
							</tr>
						</thead>
						<tbody id="viewProductsBody">
							<tr>
								<td colspan="3" style="text-align: center;">Đang tải...</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn-cancel"
						onclick="closeModal('viewPromotionModal')">Đóng</button>
				</div>
			</div>
		</div>

		<!-- ================= MODAL CHỈNH SỬA ================= -->
		<div id="editPromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Chỉnh sửa Khuyến Mãi</h2>
					<button type="button" class="close-modal"
						onclick="closeModal('editPromotionModal')">&times;</button>
				</div>
				<div class="modal-body">
					<form id="editPromotionForm" novalidate>
						<input type="hidden" id="editPromotionId">

						<div class="form-group">
							<label for="editTenkm">Tên khuyến mãi:</label> <input type="text"
								id="editTenkm" name="tenkm" required>
							<div class="error-message" id="editTenkm-error"></div>
						</div>

						<div class="form-group">
							<label for="editLoaiKm">Loại khuyến mãi:</label> <select
								id="editLoaiKm" name="loaiKm" required>
								<option value="">Chọn loại khuyến mãi</option>
								<option th:each="type : ${promotionTypes}"
									th:value="${type.name()}" th:text="${type.displayName}"></option>
							</select>
							<div class="error-message" id="editLoaiKm-error"></div>
						</div>

						<div class="form-group">
							<label for="editGiaTri">Giá trị:</label> <input type="number"
								id="editGiaTri" name="giaTri" min="0" step="0.01" required>
							<div class="error-message" id="editGiaTri-error"></div>
						</div>

						<div class="form-group">
							<label for="editMoTa">Mô tả:</label>
							<textarea id="editMoTa" name="moTa" rows="3"
								placeholder="Mô tả chi tiết..."></textarea>
							<div class="error-message" id="editMoTa-error"></div>
						</div>

						<div class="form-group">
							<label for="editThoiGianBd">Thời gian bắt đầu:</label> <input
								type="datetime-local" id="editThoiGianBd" name="thoiGianBd"
								required>
							<div class="error-message" id="editThoiGianBd-error"></div>
						</div>

						<div class="form-group">
							<label for="editThoiGianKt">Thời gian kết thúc:</label> <input
								type="datetime-local" id="editThoiGianKt" name="thoiGianKt"
								required>
							<div class="error-message" id="editThoiGianKt-error"></div>
						</div>

						<div class="form-group">
							<label for="editCustomerRank">Hạng khách hàng:</label> <select
								id="editCustomerRank" name="customerRank">
								<option value="">Chọn hạng khách hàng</option>
								<option th:each="rank : ${customerRanks}"
									th:value="${rank.name()}" th:text="${rank.displayName}"></option>
							</select>
							<div class="error-message" id="editCustomerRank-error"></div>
						</div>

						<div class="form-group">
							<label>Sản phẩm áp dụng:</label>
							<table id="editRelatedProductsTable">
								<thead>
									<tr>
										<th>Sản phẩm</th>
										<th>Thao tác</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
							<button type="button" class="btn-add-row"
								onclick="addEditProductRow()">
								<i class="fas fa-plus"></i> Thêm sản phẩm
							</button>
						</div>

						<div class="form-actions">
							<button type="submit" class="btn-submit">Cập nhật</button>
							<button type="button" class="btn-cancel"
								onclick="closeModal('editPromotionModal')">Hủy</button>
						</div>
					</form>
				</div>
			</div>
		</div>


		<!-- Global Notification Popup -->
		<div id="global-notification" class="notification-popup"
			style="display: none;">
			<span id="notification-message"></span>
			<button type="button" id="notification-close">&times;</button>
		</div>


		<!-- ================= MODAL KÍCH HOẠT / VÔ HIỆU HÓA ================= -->
		<div id="activatePromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2 id="activatePromotionTitle">Xác nhận</h2>
					<button type="button" class="close-modal"
						onclick="cancelConfirmation()">&times;</button>
				</div>
				<div class="modal-body">
					<p>
						Bạn có chắc muốn <strong id="activatePromotionActionText"></strong>
						khuyến mãi <strong id="activatePromotionName"></strong> không?
					</p>
					<div class="form-actions">
						<button type="button" class="btn-submit"
							onclick="confirmConfirmation()">Xác nhận</button>
						<button type="button" class="btn-cancel"
							onclick="cancelConfirmation()">Hủy</button>
					</div>
				</div>
			</div>
		</div>

	</div>

	<th:block layout:fragment="scripts">
		<script th:src="@{/styles/js/spinner.js}"></script>
		<script th:src="@{/styles/js/vendor/promotions.js}"></script>
	</th:block>
</body>
</html>