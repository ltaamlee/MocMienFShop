<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Người dùng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/css/admin/header.css">
    <link rel="stylesheet" href="/styles/css/admin/sidebar.css">
    <link rel="stylesheet" href="/styles/css/admin/main.css">
</head>
<body>
    <div th:insert="~{admin/fragments/header :: header}"></div>
    <div th:insert="~{admin/fragments/sidebar :: sidebar}"></div>

    <main>
        <!-- Thống kê người dùng -->
        <div class="stats-cards">
            <div class="stat-card total">
                <h3>Tổng số người dùng</h3>
                <div class="value" th:text="${totalUsers} ?: '0'">125</div>
            </div>
            <div class="stat-card active">
                <h3>Đang hoạt động</h3>
                <div class="value" th:text="${activeUsers} ?: '0'">98</div>
            </div>
            <div class="stat-card inactive">
                <h3>Ngừng hoạt động</h3>
                <div class="value" th:text="${inactiveUsers} ?: '0'">15</div>
            </div>
            <div class="stat-card blocked">
                <h3>Bị khóa</h3>
                <div class="value" th:text="${blockedUsers} ?: '0'">12</div>
            </div>
        </div>

        <!-- Tìm kiếm + Lọc -->
<div class="search-filter-container">
    <form th:action="@{/admin/users}" method="get">
        <div class="search-box">
            <input type="text" name="keyword" placeholder="Tìm kiếm theo tên, email, hoặc username..."
                   th:value="${keyword}">
            <button type="submit">
                <i class="fas fa-search"></i> Tìm kiếm
            </button>
        </div>

        <div class="filter-group">
            <!-- Lọc trạng thái -->
            <div class="filter-item">
                <label for="statusFilter">Trạng thái:</label>
                <select id="statusFilter" name="status" onchange="this.form.submit()">
                    <option value="">Tất cả</option>
                    <option value="1" th:selected="${status == '1'}">Hoạt động</option>
                    <option value="0" th:selected="${status == '0'}">Ngừng hoạt động</option>
                    <option value="-1" th:selected="${status == '-1'}">Bị khóa</option>
                </select>
            </div>
            <!-- Lọc vai trò -->
            <div class="filter-item">
                <label for="roleFilter">Vai trò:</label>
                <select id="roleFilter" name="roleId" onchange="this.form.submit()">
                    <option value="">Tất cả</option>
                    <option th:each="role : ${roles}"
                            th:value="${role.roleId}"
                            th:text="${role.roleName}"
                            th:selected="${roleId == role.roleId}">
                    </option>
                </select>
            </div>
        </div>
    </form>
</div>
        <div class="btn-add-container">
            <a th:href="@{/admin/users/add}" class="btn-add">
                <i class="fas fa-user-plus"></i> Thêm người dùng
            </a>
        </div>

        <!-- Bảng người dùng -->
        <div class="table-users">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên đăng nhập</th>
                        <th>Họ tên</th>
                        <th>Email</th>
                        <th>Số điện thoại</th>
                        <th>Vai trò</th>
                        <th>Ngày tạo</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
    <tr th:each="user : ${users}">
    <td th:text="${user.userId}">#001</td>
    <td th:text="${user.username}">username</td>
    <td th:text="${user.fullName}">Nguyễn Văn A</td>
    <td th:text="${user.email}">nguyenvana@email.com</td>
    <td th:text="${user.phone ?: 'Chưa cập nhật'}">0901234567</td>
    <td th:text="${user.role != null ? user.role.roleName : 'N/A'}">User</td>
    <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm')}">15/03/2024 10:30</td>

    <!-- Toggle trạng thái -->
    <td class="toggle-cell">
        <label class="switch">
            <input type="checkbox"
                   th:checked="${user.status == 1}"
                   th:data-id="${user.userId}"
                   onchange="toggleStatus(this)">
            <span class="slider round"></span>
        </label>
    </td>

    <td>
        <div class="action-buttons">
            <a th:href="@{'/admin/users/view/' + ${user.userId}}" class="btn-view">
                <i class="fas fa-eye"></i>
            </a>
            <a th:href="@{'/admin/users/edit/' + ${user.userId}}" class="btn-edit">
                <i class="fas fa-edit"></i>
            </a>
            <a th:href="@{'/admin/users/delete/' + ${user.userId}}"
               class="btn-delete"
               onclick="return confirm('Bạn có chắc chắn muốn xóa người dùng này?');">
                <i class="fas fa-trash"></i>
            </a>
        </div>
    </td>
</tr>

<tr th:if="${users == null || users.isEmpty()}">
    <td colspan="9" style="text-align:center;">Không có người dùng nào được tìm thấy.</td>
</tr>
</tbody>

            </table>
        </div>

        <!-- Phân trang -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:href="@{/admin/users(page=${currentPage - 1}, keyword=${keyword}, status=${status})}"
               th:classappend="${currentPage == 0} ? 'disabled' : ''"
               th:if="${currentPage > 0}">
                <i class="fas fa-chevron-left"></i> Trước
            </a>

            <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
               th:href="@{/admin/users(page=${i}, keyword=${keyword}, status=${status})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active' : ''">1</a>

            <a th:href="@{/admin/users(page=${currentPage + 1}, keyword=${keyword}, status=${status})}"
               th:if="${currentPage < totalPages - 1}">
                Sau <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </main>

    <div th:insert="~{admin/fragments/footer :: footer}"></div>
</body>
</html>
