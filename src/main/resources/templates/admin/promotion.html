<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layout}">
<head>
<title>Promotion - Discount</title>
<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/admin/config.css">
</th:block>
</head>
<body>
	<div layout:fragment="content">

		<!-- THỐNG KÊ KHUYẾN MÃI -->
		<div class="stats-cards">
			<div class="stat-card total">
				<h3>Tổng số khuyến mãi</h3>
				<div class="value" id="totalPromotionsStat"
					th:text="${totalPromotions} ?: '0'">0</div>
			</div>

			<div class="stat-card active">
				<h3>Đang hoạt động</h3>
				<div class="value" id="activePromotionsStat"
					th:text="${activePromotions} ?: '0'">0</div>
			</div>
			<div class="stat-card expiring">
				<h3>Sắp hết hạn</h3>
				<div class="value" id="expiringPromotionsStat"
					th:text="${expiringPromotions} ?: '0'">0</div>
			</div>

			<div class="stat-card expired">
				<h3>Đã hết hạn</h3>
				<div class="value" id="expiredPromotionsStat"
					th:text="${expiredPromotions} ?: '0'">0</div>
			</div>
		</div>

		<div class="search-filter-container">
			<form id="searchFilterForm" th:action="@{/admin/promotion}"
				method="get">
				<div class="search-box">
					<input type="text" name="keyword"
						placeholder="Tìm kiếm theo tên..." th:value="${keyword}">
					<button type="submit">
						<i class="fas fa-search"></i> Tìm kiếm
					</button>
				</div>

				<div class="filter-group">
					<div class="filter-item">
						<label for="typeFilter">Loại khuyến mãi:</label> <select id="typeFilter"
							name="type" required>
							<option value="">Chọn loại khuyến mãi</option>
							<option th:each="type : ${promotionTypes}"
								th:value="${type.name()}" th:text="${type.displayName}"></option>
						</select>
					</div>

					<div class="filter-item">
						<label for="statusFilter">Trạng thái:</label> <select
							id="statusFilter" name="status">
							<option value="">Tất cả trạng thái</option>
							<option th:each="status : ${promotionStatuses}"
								th:value="${status.name()}"
								th:text="${status.displayName ?: status.name()}"></option>
						</select>
					</div>


					<div class="filter-item">
						<label for="sortFilter">Sắp xếp:</label> <select id="sortFilter"
							name="sort">
							<option value="createdAt,desc">Mới nhất</option>
							<option value="createdAt,asc">Cũ nhất</option>
							<option value="name,asc">Tên (A-Z)</option>
							<option value="name,desc">Tên (Z-A)</option>
						</select>
					</div>

					<div class="filter-item">
						<label for="fromDate">Từ ngày:</label> <input type="date"
							id="fromDate" name="fromDate" class="form-control-sm">
					</div>

					<div class="filter-item">
						<label for="toDate">Đến ngày:</label> <input type="date"
							id="toDate" name="toDate" class="form-control-sm">
					</div>
				</div>
			</form>
		</div>

		<div class="d-flex justify-content-between align-items-center mb-3">
			<button class="btn btn-success" onclick="openAddPromotionModal()">
				<i class="fas fa-plus-circle"></i> Thêm khuyến mãi
			</button>
		</div>

		<!-- DANH SÁCH KHUYẾN MÃI -->
		<div class="table-promotions">
			<table>
				<thead>
					<tr>
						<th>STT</th>
						<th>Tên khuyến mãi</th>
						<th>Loại khuyến mãi</th>
						<th>Trạng thái</th>
						<th>Ngày bắt đầu</th>
						<th>Ngày kết thúc</th>
						<th>Thao tác</th>
					</tr>
				</thead>
				<tbody id="promotionTableBody">
					<tr>
						<td colspan="7" style="text-align: center;">KHÔNG CÓ DỮ LIỆU</td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="pagination" id="promotionPagination"></div>

		<!-- THÊM KHUYẾN MÃI CHO ADMIN -->
		<div id="addPromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Thêm Khuyến Mãi Toàn Sàn</h2>
					<button type="button" class="close-modal"
						onclick="closeModal('addPromotionModal')">&times;</button>
				</div>
				<div class="modal-body">
					<form id="promotionForm" novalidate>

						<!-- Tên khuyến mãi -->
						<div class="form-group">
							<label for="name">Tên khuyến mãi:</label> <input type="text"
								id="name" name="name" required>
							<div class="error-message" id="name-error"></div>
						</div>

						<!-- Loại khuyến mãi -->
					<div class="form-group">
						<label for="promoType">Loại khuyến mãi:</label> <select id="promoType"
							name="type" required>
								<option value="">Chọn loại khuyến mãi</option>
								<option th:each="type : ${promotionTypes}"
									th:value="${type.name()}" th:text="${type.displayName}"></option>
							</select>
							<div class="error-message" id="type-error"></div>
						</div>

						<!-- Giá trị -->
						<div class="form-group">
							<label for="value">Giá trị:</label> <input type="number"
								id="value" name="value" min="0" step="0.01" required>
							<div class="error-message" id="value-error"></div>
						</div>

						<!-- Banner (tùy chọn, upload ảnh) -->
						<div class="form-group">
							<label for="banner">Banner:</label> <input type="file"
								id="banner" name="banner" accept="image/*"> <small
								class="text-muted">Chỉ nhận file ảnh (jpg, png, ...)</small>
							<div class="error-message" id="banner-error"></div>
						</div>

						<!-- Ribbon (tùy chọn) -->
						<div class="form-group">
							<label for="ribbon">Ribbon:</label> <input type="text"
								id="ribbon" name="ribbon" placeholder="Ví dụ: HOT, GIẢM 50%">
							<div class="error-message" id="ribbon-error"></div>
						</div>


						<!-- Thời gian bắt đầu -->
						<div class="form-group">
							<label for="startDate">Thời gian bắt đầu:</label> <input
								type="datetime-local" id="startDate" name="startDate" required>
							<div class="error-message" id="startDate-error"></div>
						</div>

						<!-- Thời gian kết thúc -->
						<div class="form-group">
							<label for="endDate">Thời gian kết thúc:</label> <input
								type="datetime-local" id="endDate" name="endDate" required>
							<div class="error-message" id="endDate-error"></div>
						</div>

						<!-- Nút lưu -->
						<div class="form-group text-right">
							<button type="submit" class="btn btn-primary">Lưu Khuyến
								Mãi</button>
						</div>

					</form>
				</div>
			</div>
		</div>
		
		<!-- CHỈNH SỬA KHUYẾN MÃI TOÀN SÀN -->
		<div id="editPromotionModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Chỉnh Sửa Khuyến Mãi Toàn Sàn</h2>
					<button type="button" class="close-modal"
						onclick="closeModal('editPromotionModal')">&times;</button>
				</div>
				<div class="modal-body">
					<form id="editPromotionForm" novalidate>
						<input type="hidden" id="editPromotionId">
						
						<!-- Tên khuyến mãi -->
						<div class="form-group">
							<label for="editName">Tên khuyến mãi:</label> 
							<input type="text" id="editName" name="name" required>
						</div>

						<!-- Loại khuyến mãi -->
						<div class="form-group">
							<label for="editPromoType">Loại khuyến mãi:</label> 
							<select id="editPromoType" name="type" required>
								<option value="">Chọn loại khuyến mãi</option>
								<option th:each="type : ${promotionTypes}"
									th:value="${type.name()}" th:text="${type.displayName}"></option>
							</select>
						</div>

						<!-- Giá trị -->
						<div class="form-group">
							<label for="editValue">Giá trị:</label> 
							<input type="number" id="editValue" name="value" min="0" step="0.01" required>
						</div>

						<!-- Banner hiện tại -->
						<div class="form-group" id="currentBannerSection" style="display: none;">
							<label>Banner hiện tại:</label>
							<div id="currentBannerPreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
								<!-- Hiển thị ảnh banner hiện tại -->
							</div>
						</div>

						<!-- Upload banner mới -->
						<div class="form-group">
							<label for="editBanner">Thêm/Thay đổi Banner:</label> 
							<input type="file" id="editBanner" name="banner" accept="image/*" multiple>
							<small class="text-muted">Có thể chọn nhiều ảnh. Banner mới sẽ thay thế banner cũ.</small>
						</div>

						<!-- Ribbon -->
						<div class="form-group">
							<label for="editRibbon">Ribbon:</label> 
							<input type="text" id="editRibbon" name="ribbon" placeholder="Ví dụ: HOT, GIẢM 50%">
						</div>

						<!-- Thời gian bắt đầu -->
						<div class="form-group">
							<label for="editStartDate">Thời gian bắt đầu:</label> 
							<input type="datetime-local" id="editStartDate" name="startDate" required>
						</div>

						<!-- Thời gian kết thúc -->
						<div class="form-group">
							<label for="editEndDate">Thời gian kết thúc:</label> 
							<input type="datetime-local" id="editEndDate" name="endDate" required>
						</div>

						<!-- Nút lưu -->
						<div class="form-group text-right">
							<button type="button" class="btn btn-secondary" onclick="closeModal('editPromotionModal')">Hủy</button>
							<button type="submit" class="btn btn-primary">Cập Nhật</button>
						</div>

					</form>
				</div>
			</div>
		</div>
		
		<th:block layout:fragment="scripts">
			<script th:src="@{/styles/js/admin/promotion.js}"></script>
		</th:block>
	</div>
</body>
</html>