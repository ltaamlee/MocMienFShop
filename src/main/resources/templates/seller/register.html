<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Đăng ký Shop</title>
  <link rel="stylesheet" th:href="@{/styles/css/seller.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"/>
</head>
<body>

  <!-- Header + Sidebar -->
  <div th:insert="~{seller/fragments/header :: header}"></div>

  <main class="main-content show" style="width:100%;">
    <div th:insert="~{seller/fragments/sidebar :: sidebar}"></div>

    <section class="mm-register" id="registerSection">
      <div class="mm-register__head">
        <h2><i class="fa-solid fa-square-plus"></i> Đăng ký cửa hàng</h2>
        <p>Điền thông tin bên dưới và gửi yêu cầu để admin duyệt kích hoạt shop.</p>
      </div>



      <form class="mm-form" id="shopRegisterForm" action="" method="post" enctype="multipart/form-data" novalidate>
        <div class="grid2">
          <div class="field">
            <label>Tên cửa hàng <span>*</span></label>
            <input type="text" name="shopname" placeholder="Ví dụ: Mộc Miên Florist" required>
            <small class="invalid"></small>
          </div>

          <div class="field">
            <label>Số điện thoại liên hệ <span>*</span></label>
            <input type="tel" name="phone" placeholder="09xx xxx xxx" required>
            <small class="invalid"></small>
          </div>
        </div>

        <div class="grid2">
          <div class="field">
            <label>Email</label>
            <input type="email" name="email" placeholder="shop@example.com">
            <small class="invalid"></small>
          </div>

          <div class="field">
            <label>Website / Fanpage</label>
            <input type="text" name="website" placeholder="https://...">
            <small class="invalid"></small>
          </div>
        </div>

        <div class="grid3">
          <div class="field">
            <label>Tỉnh/Thành <span>*</span></label>
            <input type="text" name="province" placeholder="TP. Hồ Chí Minh" required>
          </div>
          <div class="field">
            <label>Quận/Huyện <span>*</span></label>
            <input type="text" name="district" placeholder="Quận 1" required>
          </div>
          <div class="field">
            <label>Phường/Xã <span>*</span></label>
            <input type="text" name="ward" placeholder="Phường Bến Nghé" required>
          </div>
        </div>

        <div class="field">
          <label>Địa chỉ chi tiết <span>*</span></label>
          <input type="text" name="street" placeholder="12 Nguyễn Huệ" required>
          <small class="desc">Địa chỉ sẽ hiển thị cho khách hàng.</small>
        </div>

        <div class="field">
          <label>Mô tả ngắn về shop</label>
          <textarea name="description" rows="4" placeholder="Giới thiệu nhanh về shop, dòng sản phẩm chủ lực..."></textarea>
        </div>

        <!-- Upload + preview -->
        <div class="grid2">
          <div class="field">
            <label>Logo (PNG/JPG) <small class="muted">(≤ 2MB)</small></label>
            <div class="upload-box" data-target="#logoPreview">
              <input type="file" id="logoFile" name="logoFile" accept="image/*">
              <span><i class="fa-regular fa-image"></i> Chọn ảnh logo</span>
            </div>
            <div class="img-preview" id="logoPreview" aria-label="Xem trước logo"></div>
          </div>

          <div class="field">
            <label>Ảnh cover (tùy chọn) <small class="muted">(≤ 4MB)</small></label>
            <div class="upload-box" data-target="#coverPreview">
              <input type="file" id="coverFile" name="coverFile" accept="image/*">
              <span><i class="fa-regular fa-image"></i> Chọn ảnh cover</span>
            </div>
            <div class="img-preview wide" id="coverPreview" aria-label="Xem trước ảnh cover"></div>
          </div>
        </div>

        <div class="field checkbox">
          <label>
            <input type="checkbox" id="tosCheck" required>
            Tôi cam kết thông tin là chính xác và đồng ý với <a href="#" class="link">Điều khoản</a>.
          </label>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary" id="submitBtn">
            <i class="fa-solid fa-paper-plane"></i> Gửi yêu cầu cho Admin
          </button>
          <a th:href="@{/seller/dashboard}" class="btn-ghost">Hủy</a>
        </div>
      </form>
    </section>
  </main>

  <div th:insert="~{seller/fragments/footer :: footer}"></div>

  <!-- JS thuần: preview ảnh, validate nhẹ, chặn double submit -->
  <script>
    (function(){
      const form = document.getElementById('shopRegisterForm');
      const btn  = document.getElementById('submitBtn');
      const logoInput  = document.getElementById('logoFile');
      const coverInput = document.getElementById('coverFile');

      const MAX_LOGO  = 2 * 1024 * 1024;   // 2MB
      const MAX_COVER = 4 * 1024 * 1024;   // 4MB
      const IMG_TYPES = ['image/png','image/jpeg','image/jpg','image/webp'];

      function previewImage(input, targetSel, wide=false){
        const target = document.querySelector(targetSel);
        target.innerHTML = '';
        const file = input.files && input.files[0];
        if (!file) return;

        if (!IMG_TYPES.includes(file.type)) {
          alert('Ảnh phải là PNG/JPG/WebP');
          input.value = ''; return;
        }
        const max = wide ? MAX_COVER : MAX_LOGO;
        if (file.size > max){
          alert('Ảnh vượt quá dung lượng cho phép');
          input.value = ''; return;
        }
        const url = URL.createObjectURL(file);
        const img = document.createElement('img');
        img.src = url; img.alt = 'preview';
        target.appendChild(img);
      }

      logoInput?.addEventListener('change', e => previewImage(e.target, '#logoPreview'));
      coverInput?.addEventListener('change', e => previewImage(e.target, '#coverPreview', true));

      // Normalize website khi blur (thêm http:// nếu thiếu)
      const website = form.querySelector('input[name="website"]');
      website?.addEventListener('blur', () => {
        const v = website.value.trim();
        if (v && !/^https?:\/\//i.test(v)) website.value = 'https://' + v;
      });

      // Định dạng nhẹ số điện thoại
      const phone = form.querySelector('input[name="phone"]');
      phone?.addEventListener('input', () => {
        phone.value = phone.value.replace(/[^\d\s+]/g, '');
      });

      // Validate HTML5 + chặn double submit (frontend)
      form.addEventListener('submit', (e) => {
        if (!form.checkValidity()){
          e.preventDefault();
          form.reportValidity();
          return;
        }
        // demo frontend: chặn submit thật
        e.preventDefault();
        btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Đang gửi...';

        // giả lập gửi xong:
        setTimeout(() => {
          btn.disabled = false; btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Gửi yêu cầu cho Admin';
          alert('(Frontend) Đã kiểm tra form. Backend sẽ nhận dữ liệu khi nối API.');
        }, 1200);
      });
    })();
  </script>
</body>
</html>



