<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{customer/layout}">
<head>
<meta charset="UTF-8">
<title>ƒê·ªãa ch·ªâ c·ªßa t√¥i - MocMien</title>
<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/customer/base.css">
	<link rel="stylesheet" href="/styles/css/customer/account-sidebar.css">
	<link rel="stylesheet" href="/styles/css/customer/account-address.css">
</th:block>
</head>
<body>
	<div layout:fragment="content">
		<main class="account-page">
			<section class="container account-container">
				<div class="account-layout">

					<!-- Sidebar -->
					<div th:replace="~{customer/fragments/account-sidebar :: sidebar}"></div>

					<!-- N·ªôi dung ch√≠nh -->
					<div class="account-content">
						<div class="address-header">
							<h2>ƒê·ªãa ch·ªâ c·ªßa t√¥i</h2>
							<a href="#" class="btn-add-address">+ Th√™m ƒë·ªãa ch·ªâ m·ªõi</a>
						</div>

						<!-- ‚úÖ Danh s√°ch ƒë·ªãa ch·ªâ -->
						<div class="address-list">
							<div th:each="addr : ${addresses}" class="address-item">
								<div class="address-left">
									<div class="address-header-line">
										<span class="name" th:text="${addr.fullName}">Nguy·ªÖn
											VƒÉn A</span> <span class="divider">|</span> <span class="phone"
											th:text="${addr.phone}">(+84) 909 123 456</span>
									</div>
									<div class="address-detail"
										th:text="${addr.line + ', ' + addr.ward + ', ' + addr.district + ', ' + addr.province}">
										22C, Ph∆∞·ªùng TƒÉng Nh∆°n Ph√∫ B, Th√†nh ph·ªë Th·ªß ƒê·ª©c, TP H·ªì Ch√≠ Minh
									</div>
									<div th:if="${addr.isDefault}" class="badge-default">M·∫∑c
										ƒë·ªãnh</div>
								</div>

								<!-- B√™n ph·∫£i -->
								<div class="address-right">
									<a href="#" class="link edit-address"
										th:attr="data-id=${addr.id},
												data-fullname=${addr.fullName},
												data-phone=${addr.phone},
												data-line=${addr.line},
												data-ward=${addr.ward},
												data-district=${addr.district},
												data-province=${addr.province},
												data-isdefault=${addr.isDefault}">
										C·∫≠p nh·∫≠t </a> <a th:if="${!addr.isDefault}"
										th:href="@{'/account/address/delete/' + ${addr.id}}"
										class="link delete"
										onclick="return confirm('X√≥a ƒë·ªãa ch·ªâ n√†y?')">X√≥a</a>
									<button th:if="${!addr.isDefault}"
										th:attr="onclick=|window.location.href='/account/address/set-default/${addr.id}'|"
										class="btn-set-default">Thi·∫øt l·∫≠p m·∫∑c ƒë·ªãnh</button>
								</div>
							</div>

							<div th:if="${#lists.isEmpty(addresses)}" class="no-address">
								<p>Ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o ƒë∆∞·ª£c l∆∞u.</p>
							</div>
						</div>
					</div>

				</div>
			</section>
		</main>

		<!-- üì¶ Popup th√™m / s·ª≠a -->
		<div id="addressModal" class="modal hidden">
			<div class="modal-content">
				<h3 id="modalTitle">Th√™m ƒë·ªãa ch·ªâ m·ªõi</h3>

				<form id="addressForm" th:action="@{/account/address/save}"
					method="post">
					<input type="hidden" name="id" id="id">
					<input type="hidden" name="latitude" id="latitude">
					<input type="hidden" name="longitude" id="longitude">

					<!-- üßç‚Äç‚ôÄÔ∏è H·ªç t√™n -->
					<div class="form-group">
						<label>H·ªç t√™n</label> <input type="text" name="fullName"
							id="fullName" placeholder="VD: Nguy·ªÖn VƒÉn A" required />
					</div>

					<!-- üìû S·ªë ƒëi·ªán tho·∫°i -->
					<div class="form-group">
						<label>S·ªë ƒëi·ªán tho·∫°i</label> <input type="text" name="phone"
							id="phone" placeholder="VD: 0909123456" required />
					</div>

					<!-- üè† ƒê·ªãa ch·ªâ chi ti·∫øt -->
					<div class="form-group">
						<label>ƒê·ªãa ch·ªâ</label> <input type="text" name="line" id="line"
							placeholder="VD: 22C, L√†ng TƒÉng Ph√∫" required />
					</div>

					<!-- üó∫Ô∏è B·∫£n ƒë·ªì -->
					<div class="form-group">
						<label>V·ªã tr√≠ tr√™n b·∫£n ƒë·ªì</label>
						<div id="addressMap" style="width: 100%; height: 260px; border: 1px solid #eee; border-radius: 8px;"></div>
						<small>G·ª£i √Ω: nh·∫≠p ƒë·ªãa ch·ªâ, ch·ªçn g·ª£i √Ω t·ª´ Google ho·∫∑c k√©o th·∫£ marker ƒë·ªÉ tinh ch·ªânh.</small>
					</div>

					<!-- üåç Khu v·ª±c h√†nh ch√≠nh -->
					<div class="form-group">
						<label>Khu v·ª±c</label>
						<div class="address-select-group">
							<input type="text" id="province" name="province"
								placeholder="T·ªânh/Th√†nh ph·ªë" readonly required /> <input
								type="text" id="district" name="district"
								placeholder="Qu·∫≠n/Huy·ªán" readonly required /> <input
								type="text" id="ward" name="ward" placeholder="Ph∆∞·ªùng/X√£"
								readonly required />
							<button type="button" id="openAddressPopup" class="btn-select">Ch·ªçn
								ƒë·ªãa ch·ªâ</button>
						</div>
					</div>


					<!-- üåü M·∫∑c ƒë·ªãnh -->
					<div class="form-group checkbox-group">
						<label> <input type="checkbox" name="isDefault"
							id="isDefault" /> ƒê·∫∑t l√†m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh
						</label>
					</div>

					<div class="modal-actions">
						<button type="button" id="cancelBtn">H·ªßy</button>
						<button type="submit" class="confirm-btn">L∆∞u</button>
					</div>
				</form>
			</div>
		</div>

		<!-- üìç Popup ch·ªçn ƒë·ªãa ch·ªâ -->
		<div id="addressPopup" class="popup hidden">
			<div class="popup-content">
				<h3>Ch·ªçn ƒë·ªãa ch·ªâ</h3>

				<!-- Tabs -->
				<div class="address-tabs">
					<button class="tab active" data-tab="province">T·ªânh /
						Th√†nh ph·ªë</button>
					<button class="tab" data-tab="district">Qu·∫≠n / Huy·ªán</button>
					<button class="tab" data-tab="ward">Ph∆∞·ªùng / X√£</button>
				</div>

				<!-- Search -->
				<div class="search-container">
					<input id="searchBox" type="text" class="search-box"
						placeholder="T√¨m ki·∫øm..." />
				</div>

				<!-- Danh s√°ch -->
				<div class="address-lists">
					<ul id="provinceList" class="address-list active"></ul>
					<ul id="districtList" class="address-list"></ul>
					<ul id="wardList" class="address-list"></ul>
				</div>

				<!-- N√∫t -->
				<div class="popup-actions">
					<button id="cancelPopup" class="btn-cancel">Tr·ªü l·∫°i</button>
					<button id="confirmPopup" class="btn-confirm">Ho√†n th√†nh</button>
				</div>
			</div>
		</div>


	</div>

	<th:block layout:fragment="scripts">
		<script src="/styles/js/customer/header.js"></script>
		<script th:src="@{/styles/js/customer/avatar.js}"></script>
		<script src="/styles/js/customer/account-sidebar.js"></script>
		<script th:src="@{/styles/js/customer/account-address.js}"></script>
		<script th:if="${googleMapsApiKey != null && !#strings.isEmpty(googleMapsApiKey)}"
			th:src="@{'https://maps.googleapis.com/maps/api/js?key=' + ${googleMapsApiKey} + '&libraries=places&callback=initAddressMap'}" async defer></script>
		<script th:src="@{/styles/js/customer/account-address-map.js}"></script>
	</th:block>
</body>
</html>
