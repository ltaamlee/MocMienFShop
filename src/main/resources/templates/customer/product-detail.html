<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{customer/layout}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title th:text="${product.productName}"></title>

<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/customer/base.css">
	<link rel="stylesheet" href="/styles/css/customer/product-detail.css">
	<link rel="stylesheet" href="/styles/css/customer/product.css">
</th:block>
</head>

<body>
	<div layout:fragment="content" class="product-detail-page">

		<!-- ========== Chi ti·∫øt s·∫£n ph·∫©m ========== -->
		<section class="product-detail">
			<div class="image-wrapper">
				<!-- ·∫¢nh ch√≠nh -->
				<img id="mainImage" th:src="${product.mainImage}"
					th:alt="${product.productName}" class="main-photo">

				<!-- D·∫£i thumbnail -->
				<div class="thumb-carousel">
					<!-- ‚úÖ Th√™m ·∫£nh ch√≠nh v√†o ƒë·∫ßu danh s√°ch thumbnail -->
					<img th:src="${product.mainImage}"
						th:alt="${product.productName} + ' ·∫£nh ch√≠nh'"
						class="thumb active" onclick="changeMainImage(this)">

					<!-- ‚úÖ C√°c ·∫£nh gallery c√≤n l·∫°i -->
					<img th:each="img, iter : ${product.imageUrls}" th:src="${img}"
						th:alt="${product.productName} + ' ·∫£nh ' + ${iter.index}"
						class="thumb" onclick="changeMainImage(this)">
				</div>
			</div>


			<div class="right">
				<h1 th:text="${product.productName}"></h1>

				<!-- Hi·ªÉn th·ªã gi√° -->
				<p class="price"
					th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></p>

				<!-- ‚≠ê T·ªïng ƒë√°nh gi√° trung b√¨nh -->
				<div class="rating">
					<i class="fa-solid fa-star" style="color: #f7b500;"></i> <span
						th:text="${avgRating != null ? #numbers.formatDecimal(avgRating, 1, 'COMMA', 1, 'POINT') : '5.0'}"></span>
					/ 5
				</div>

				<!-- M√¥ t·∫£ s·∫£n ph·∫©m -->
				<p class="desc" th:text="${product.categoryName}"></p>

				<div class="quantity">
					<label>S·ªë l∆∞·ª£ng:</label>
					<button type="button" class="qty-btn" id="minus">‚àí</button>
					<input id="qty" type="number" value="1" min="1" readonly>
					<button type="button" class="qty-btn" id="plus">+</button>
				</div>

				<div class="buttons">
					<button id="addCart" th:data-id="${product.id}">üõí Th√™m
						v√†o gi·ªè h√†ng</button>
					<button id="buyNow" th:data-id="${product.id}">‚ö° Mua ngay</button>
				</div>
			</div>
		</section>


		<!-- ========== ƒê√°nh gi√° ========== -->
		<section class="reviews">
			<h2>ƒê√°nh gi√° s·∫£n ph·∫©m</h2>

			<!-- C√≥ ƒë√°nh gi√° -->
			<div class="review-list" th:if="${!#lists.isEmpty(reviews)}">
				<article class="review-item" th:each="r : ${reviews}">
					<!-- avatar tr√°i -->
					<div class="review-avatar-wrap">
						<img class="review-avatar"
							th:src="${r.user != null && r.user.avatar != null ? r.user.avatar : '/styles/image/default-avatar.png'}"
							alt="avatar">
					</div>

					<!-- n·ªôi dung ph·∫£i -->
					<div class="review-body">
						<!-- t√™n -->
						<div class="review-name"
							th:text="${r.user != null ? r.user.username : '·∫®n danh'}"></div>

						<!-- sao ngay d∆∞·ªõi t√™n -->
						<div class="review-stars">
							<i class="fa-solid fa-star"
								th:each="i : ${#numbers.sequence(1,5)}"
								th:classappend="${i <= r.rating ? 'active' : 'inactive'}"></i>
						</div>

						<!-- meta: th·ªùi gian + ph√¢n lo·∫°i (n·∫øu c√≥) -->
						<div class="review-meta">
							<span class="review-time"
								th:text="${#temporals.format(r.createAt, 'yyyy-MM-dd HH:mm')}"></span>
							<span class="sep" th:if="${r.product != null}"> | </span> <span
								class="review-variant" th:if="${r.product != null}"> Ph√¢n
								lo·∫°i h√†ng: <span th:text="${r.product.size}">--</span>
							</span>
						</div>

						<!-- b√¨nh lu·∫≠n -->
						<div class="review-text" th:text="${r.comment}"></div>


						<!--
        <div class="review-media" th:if="${r.images != null}">
          <a th:each="img : ${r.images}" th:href="${img}" target="_blank">
            <img th:src="${img}" alt="media">
          </a>
        </div>
        -->
					</div>
				</article>
			</div>

			<!-- Kh√¥ng c√≥ ƒë√°nh gi√° -->
			<div th:if="${#lists.isEmpty(reviews)}" class="no-review">
				<p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s·∫£n ph·∫©m n√†y.</p>
			</div>
		</section>

		<!-- ========== S·∫£n ph·∫©m li√™n quan ========== -->
		<section class="related">
			<h2>S·∫£n ph·∫©m li√™n quan</h2>
			<div class="related-grid">
				<div th:each="r : ${relatedProducts}" class="card">
					<a th:href="@{'/product/' + ${r.maSP}}"> <img
						th:src="${r.hinhAnh}" th:alt="${r.tenSP}">
						<h3 th:text="${r.tenSP}"></h3>
						<p class="price"
							th:text="${#numbers.formatDecimal(r.giaGoc, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></p>
					</a>
				</div>
			</div>
		</section>
	</div>

	<th:block layout:fragment="scripts">
		<script src="/styles/js/customer/header.js"></script>
		<script th:src="@{/styles/js/customer/avatar.js}"></script>
		<script th:src="@{/styles/js/customer/product.js}"></script>
	</th:block>
</body>
</html>
