<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{customer/layout}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4Petals - Tài khoản</title>

<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/customer/base.css">
	<link rel="stylesheet" href="/styles/css/customer/account.css">
	<link rel="stylesheet" href="/styles/css/customer/account-sidebar.css">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</th:block>
</head>
<body>
	<div layout:fragment="content">
		<main class="account-page">
			<section class="container account-container">
				<div class="account-layout">

					<!-- Sidebar -->
					<div th:replace="~{customer/fragments/account-sidebar :: sidebar}"></div>

					<!-- Nội dung chính -->
					<div class="account-content">
						<h2>Hồ sơ cá nhân</h2>
						<div class="profile-section">

							<!-- Cột bên trái: Avatar -->
							<div class="profile-avatar">
								<div class="avatar-frame">
									<img th:src="@{${user.avatar != null ? user.avatar : '/styles/image/customer/default-avatar.png'}}"
										alt="Avatar" id="avatar-preview">
								</div>
								<form method="post" enctype="multipart/form-data"
									th:action="@{/account/avatar/upload}">
									<input type="file" id="avatar-input" name="file"
										accept="image/*" style="display: none;">
									<div class="avatar-buttons">
										<button type="button" class="btn-upload"
											onclick="document.getElementById('avatar-input').click()">Tải
											ảnh mới</button>
									</div>
								</form>

								<!-- ✅ Popup xem trước ảnh -->
								<div id="preview-popup" class="preview-popup" style="display: none;">
									<div class="preview-overlay" onclick="closePreviewPopup()"></div>
									<div class="preview-box">
										<button class="close-btn" onclick="closePreviewPopup()">&times;</button>
										<h3>Xem trước ảnh đại diện</h3>
										<div class="preview-image-wrapper">
											<img id="preview-image" src="" alt="Xem trước">
										</div>
										<div class="preview-actions">
											<button id="confirm-upload" class="btn-save">Lưu</button>
										</div>
									</div>
								</div>
							</div>

							<!-- Thông tin người dùng -->
							<div class="profile-info">
								<div class="info-display">
									<div class="form-group">
										<label>Họ và tên:</label>
										<input type="text" id="display-fullName" readonly
											th:value="${user.userProfile.fullName}">
									</div>

									<div class="form-group">
										<label>Ngày sinh:</label>
										<input type="text" id="display-dob" readonly
											th:value="${user.userProfile.dob}">
									</div>

									<div class="form-group">
										<label>Giới tính:</label>
										<input type="text" id="display-gender" readonly
											th:value="${user.userProfile.gender}">
									</div>

									<div class="form-group">
										<label>Email:</label>
										<input type="email" id="display-email" readonly
											th:value="${user.email}">
									</div>

									<div class="form-group">
										<label>Số điện thoại:</label>
										<input type="text" id="display-phone" readonly
											th:value="${user.phone}">
									</div>

									<div class="form-group">
										<label>Điểm tích lũy:</label>
										<input type="text" id="display-point" readonly
											th:value="${user.userProfile.point}">
									</div>

									<div class="form-group">
										<label>Số dư ví:</label>
										<input type="text" id="display-ewallet" readonly
											th:value="${user.userProfile.eWallet}">
									</div>
								</div>

								<button type="button" id="btn-edit-info" class="btn-edit">
									Cập nhật thông tin cá nhân
								</button>
							</div>

							<!-- Popup sửa thông tin -->
							<div id="editInfoPopup" class="popup-overlay">
								<div class="popup-content popup-wide">
									<button class="close-btn" onclick="closeEditPopup()">&times;</button>
									<h3>Chỉnh sửa thông tin cá nhân</h3>

									<form id="editInfoForm" th:action="@{/account/update}" method="post">
										<div class="form-group">
											<label>Họ và tên:</label>
											<input type="text" id="edit-fullName" name="fullName"
												th:value="${user.userProfile.fullName}" required>
										</div>

										<div class="form-group">
											<label>Ngày sinh:</label>
											<input type="date" id="edit-dob" name="dob"
												th:value="${user.userProfile.dob}">
										</div>

										<div class="form-group">
											<label>Giới tính:</label>
											<select id="edit-gender" name="gender">
												<option value="Nam"
													th:selected="${user.userProfile.gender == 'Nam'}">Nam</option>
												<option value="Nữ"
													th:selected="${user.userProfile.gender == 'Nữ'}">Nữ</option>
												<option value="Khác"
													th:selected="${user.userProfile.gender == 'Khác'}">Khác</option>
											</select>
										</div>

										<div class="form-group">
											<label>Email:</label>
											<input type="email" id="edit-email" name="email"
												th:value="${user.email}" readonly>
										</div>

										<div class="form-group">
											<label>Số điện thoại:</label>
											<input type="text" id="edit-phone" name="phone"
												th:value="${user.phone}">
										</div>

										<div class="popup-buttons" style="justify-content: center;">
											<button type="submit" class="btn-save">Lưu thay đổi</button>
										</div>
									</form>
								</div>
							</div>

						</div>
					</div>
			</section>
		</main>
	</div>

	<th:block layout:fragment="scripts">
		<script src="/styles/js/customer/header.js"></script>
		<script src="/styles/js/customer/account-sidebar.js"></script>
		<script src="/styles/js/customer/avatar.js"></script>
		<script src="/styles/js/customer/info.js"></script>
	</th:block>

</body>
</html>
